<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>API Form App</title>
    <script type="module">
        import React, { useState } from "https://esm.sh/react@18";
        import { createRoot } from "https://esm.sh/react-dom@18/client";
        import { Prism as SyntaxHighlighter } from "https://esm.sh/react-syntax-highlighter@15/dist/esm/prism";
        import { vscDarkPlus } from "https://esm.sh/react-syntax-highlighter@15/dist/esm/styles/prism";
        import { duotoneLight } from "https://esm.sh/react-syntax-highlighter@15/dist/esm/styles/prism";

        const App = () => {
            const [formData, setFormData] = useState({
                code: "", filename: "", type: "", lineNumber: "",
                description: "", severity: "", language: ""
            });
            const [result, setResult] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [darkMode, setDarkMode] = useState(true);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError(null);
                setResult(null);
                try {
                    const params = new URLSearchParams(
                        Object.fromEntries(Object.entries(formData).filter(([_, v]) => v))
                    );
                    const response = await fetch(`/documents?${params.toString()}`);
                    if (!response.ok) throw new Error("Failed to fetch results");
                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', {
                    className: darkMode ? 'dark' : 'light',
                    style: { padding: '1em', maxWidth: '800px', margin: 'auto' }
                },
                React.createElement('label', null,
                    React.createElement('input', {
                        type: 'checkbox',
                        checked: darkMode,
                        onChange: () => setDarkMode(!darkMode)
                    }), ' Dark Mode'
                ),
                React.createElement('form', { onSubmit: handleSubmit },
                    React.createElement('textarea', {
                        name: 'code', value: formData.code, onChange: handleChange,
                        placeholder: 'Enter code...', rows: 5, style: { width: '100%' }
                    }),
                    ['filename', 'type', 'lineNumber', 'description', 'severity', 'language'].map(name =>
                        React.createElement('input', {
                            key: name, name, value: formData[name], onChange: handleChange,
                            placeholder: name, style: { width: '100%', margin: '0.25em 0' }
                        })
                    ),
                    React.createElement('button', { type: 'submit', disabled: loading },
                        loading ? 'Searching...' : 'Search')
                ),
                error && React.createElement('div', { style: { color: 'red' } }, `Error: ${error}`),
                result && Array.isArray(result) && result.map((item, i) =>
                    React.createElement('details', { key: i, style: { marginTop: '1em' } },
                        React.createElement('summary', null, item.filename || `Result ${i + 1}`),
                        item.code && React.createElement(SyntaxHighlighter, {
                            language: item.language || 'javascript',
                            style: darkMode ? vscDarkPlus : duotoneLight,
                            wrapLines: true
                        }, item.code),
                        React.createElement('pre', null, JSON.stringify({ ...item, code: undefined }, null, 2))
                    )
                )
            );
        };

        const root = createRoot(document.getElementById("root"));
        root.render(React.createElement(App));
    </script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--fg);
        }
        input, textarea, button {
            display: block;
            padding: 0.5em;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            margin-bottom: 0.5em;
        }
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:disabled {
            background: #999;
            cursor: not-allowed;
        }
        .dark {
            --bg: #111;
            --fg: #fff;
        }
        .light {
            --bg: #fff;
            --fg: #000;
        }
    </style>
</head>
<body>
<div id="root"></div>
</body>
</html>
